>周二晚上在公司待到10点，项目快速迭代期间，虽然没我啥事儿，不过也担心测出啥需要我解决的bug。闲着没事，把之前站点重新部署了下，打开新大陆。

去年忘了是几月份部署的react的前端项目，中间有出现些问题，解决了部分，还要个别因为服务器内存不够，还有一个是无法引用压缩模块。今天突然想起最近用到的一些技术栈，dva本身也是在react上做了一层封装，少了webpack项目的模块引用设置，不需要自己去引用各种css及html模块以及压缩模块。dva把这些都封装好了，创建项目后只需要执行一个命令：

```
npm start
```
就可以了。于是打算把之前的项目移植到dva里面。超乎意料的只花了半个小时就over了，包括了代码移植、动态路由配置、打包以及部署上线，打包出来的js文件只有107kb,css文件2.9kb。部署上线完全只需要部署打包出来的文件，nginx代理访问静态文件就可以。突然想到之前项目在服务器上问题所在了，我是完全把代码拉到服务器上

```
npm  install 
```
之后，再执行

```
npm run build
```
然后执行

```
npm run start:prod
```
去跑自以为的生产环境，用pm2后台运行，在nginx配置的时候通过域名映射端口去访问。这本身就是一个傻逼的操作，因为在项目拉到服务器之前本身已经build编译了一次得到了静态文件，拉倒服务器之后只需要修改nginx配置把域名指向项目的静态文件即可。这是最直接的方式，但是我确在服务器上下载模块：

* 第一：服务器内存耗不起
* 第二：模块下载完了之后占据磁盘空间太大
* 第三：最为致命的，访问是像nodejs开启线程一样用PM2在后台开了一个线程专门跑这个服务，况且本身服务器配置就是最低级的，之前还跑了一个mysql，top一下发现占用内存高达50%+，再跑一个node不崩才怪
* 第四：因为ubuntu系统上压缩配置不当，run出来的文件大小达到16m,网页加载5s+了，可怕

---
>现在，秒开。。。

<img src="https://share.alihanniba.com/mac/2017-03-07-154838.jpg"/>

<img src="https://share.alihanniba.com/mac/2017-03-07-155108.jpg"/>

